"undefined"!=typeof module&&"undefined"!=typeof exports&&module.exports===exports&&(module.exports="monospaced.qrcode"),angular.module("monospaced.qrcode",[]).directive("qrcode",["$window",function(e){var o=!!e.CanvasRenderingContext2D,r={L:"Low",M:"Medium",Q:"Quartile",H:"High"};return{restrict:"E",template:'<canvas class="qrcode"></canvas>',link:function(e,n,t){var i,a,d,c,f,u,s,l,v,g=n[0],h=n.find("canvas"),m=h[0],b=o?m.getContext("2d"):null,p="download"in t,w=t.href,M=p||w?document.createElement("a"):"",q=/^\s+|\s+$/g,k={foreground:"#000",background:"#fff"},$=function(e){k.foreground=e||k.foreground},C=function(e){k.background=e||k.background},x=function(e){a=Math.max(1,Math.min(parseInt(e,10),40))||5},L=function(e){d=e in r?e:"M"},D=function(e){if(e){c=e.replace(q,""),(l=qrcode(a,d)).addData(c);try{l.make()}catch(r){var o;if(a>=40)throw new Error("Data is too long",r);return x(o=a+1),console.warn("qrcode version is too low and has been incremented to",o),void D(e)}i=!1,u=l.getModuleCount()}},y=function(e){f=parseInt(e,10)||2*u,s=f/u,m.width=m.height=f},H=function(){if(l){if(i)return M&&(M.removeAttribute("download"),M.title="",M.href="#_"),o||(g.innerHTML='<img src width="'+f+'"height="'+f+'"class="qrcode">'),void e.$emit("qrcode:error",i);if(p&&(g.download="qrcode.png",g.title="Download QR code"),o){if(function(e,o,r,n,t){for(var i=0;i<r;i++)for(var a=0;a<r;a++){var d=Math.ceil((a+1)*n)-Math.floor(a*n),c=Math.ceil((i+1)*n)-Math.floor(i*n);e.fillStyle=o.isDark(i,a)?t.foreground:t.background,e.fillRect(Math.round(a*n),Math.round(i*n),d,c)}}(b,l,u,s,k),p)return void(g.href=m.toDataURL("image/png"))}else if(g.innerHTML=l.createImgTag(s,0),(v=n.find("img")).addClass("qrcode"),p)return void(g.href=v[0].src);w&&(g.href=w)}};M&&(M.className="qrcode-link",h.wrap(M),g=g.firstChild),$(t.color),C(t.background),x(t.version),L(t.errorCorrectionLevel),y(t.size),t.$observe("version",function(e){e&&(x(e),D(c),y(f),H())}),t.$observe("errorCorrectionLevel",function(e){e&&(L(e),D(c),y(f),H())}),t.$observe("data",function(e){e&&(D(e),y(f),H())}),t.$observe("size",function(e){e&&(y(e),H())}),t.$observe("color",function(e){e&&($(e),H())}),t.$observe("background",function(e){e&&(C(e),H())}),t.$observe("href",function(e){e&&(w=e,H())})}}}]);